<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GR PROGRAM PRO 3.0</title>

  <style>
    :root {
      --bg-page: #f5f6fa;
      --bg-panel: #ffffff;
      --bg-soft: #f9fafc;

      --gold: #d9a643;
      --gold-soft: #f7d98a;
      --gold-light: #fff3c7;

      --border-soft: #e0e3ec;
      --border-strong: #c5c9d6;

      --text-main: #22252f;
      --text-sub: #6c7284;
      --text-gray: #9aa0b3;

      --danger: #ff5f6c;

      --radius-lg: 20px;
      --radius-md: 14px;

      --shadow-soft: 0 10px 30px rgba(9, 9, 30, 0.10);
      --transition-fast: 0.18s ease-out;

      --ripple-x: 50%;
      --ripple-y: 50%;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Noto Sans TC", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: linear-gradient(180deg, #ffffff 0, #f6f7fb 45%, #e4e9f7 100%);
      color: var(--text-main);
      overflow-x: hidden;
    }

    /* æ–œç·šå¾®äº®ç´‹è·¯ */
    .bg-rays {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background:
        repeating-linear-gradient(
          135deg,
          rgba(180, 187, 207, 0.35) 0,
          rgba(180, 187, 207, 0.35) 1px,
          transparent 3px,
          transparent 10px
        );
      opacity: 0.06;
      z-index: 0;
    }

    /* å¤§ç¯„åœæŸ”å…‰ */
    .bg-glow {
      position: fixed;
      inset: -30%;
      pointer-events: none;
      background:
        radial-gradient(circle at 10% 0%, rgba(247, 217, 138, 0.55), transparent 60%),
        radial-gradient(circle at 85% 15%, rgba(255, 255, 255, 0.95), transparent 55%),
        radial-gradient(circle at 90% 100%, rgba(197, 208, 240, 0.55), transparent 55%);
      mix-blend-mode: screen;
      animation: glowMove 18s ease-in-out infinite alternate;
      z-index: 0;
    }

    @keyframes glowMove {
      0%   { transform: translate3d(-4%, 0, 0) scale(1); }
      50%  { transform: translate3d(4%, -2%, 0) scale(1.03); }
      100% { transform: translate3d(-2%, 2%, 0) scale(1.01); }
    }

    /* â­ é‡‘è‰²æ˜Ÿç©ºé»é» */
    .bg-stars {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(rgba(247, 217, 138, 0.95) 0.9px, transparent 0.9px) 0 0 / 3px 3px,
        radial-gradient(rgba(255, 243, 199, 0.95) 1.1px, transparent 1.1px) 40px 60px / 4px 4px,
        transparent;
      opacity: 0.36;
      mix-blend-mode: soft-light;
      z-index: 0;
      animation: starsDrift 40s linear infinite alternate;
    }

    @keyframes starsDrift {
      0%   { transform: translate3d(0, 0, 0); }
      50%  { transform: translate3d(-25px, 15px, 0); }
      100% { transform: translate3d(20px, -10px, 0); }
    }

    /* ğŸŒ  å¤šæ¢é‡‘è‰²å¼§å½¢æµæ˜Ÿï¼ˆæ‰‹æ©Ÿä¹Ÿçœ‹å¾—åˆ°ï¼Œé€Ÿåº¦/æ™‚é–“éš¨æ©Ÿï¼‰ */
    .bg-meteors {
      position: fixed;
      inset: -10%;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
    }

    .meteor-trail {
      position: absolute;
      left: 0;
      top: 0;
      width: 260px;
      height: 3px;
      background: linear-gradient(
        90deg,
        rgba(247, 217, 138, 0),
        rgba(247, 217, 138, 1),
        rgba(247, 217, 138, 0)
      );
      opacity: 0;
      border-radius: 999px;
      filter: drop-shadow(0 0 10px rgba(247, 217, 138, 0.9));
      transform-origin: left center;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
    }

    /* ä¸‰ç¨®ä¸åŒå¼§ç·šè·¯å¾‘ */
    @keyframes meteorCurve1 {
      0%   { transform: translate3d(0, 0, 0) rotate(22deg);  opacity: 0; }
      10%  { opacity: 1; }
      45%  { transform: translate3d(-260px, 120px, 0) rotate(26deg); opacity: 1; }
      100% { transform: translate3d(-520px, 260px, 0) rotate(30deg); opacity: 0; }
    }

    @keyframes meteorCurve2 {
      0%   { transform: translate3d(0, 0, 0) rotate(30deg);  opacity: 0; }
      12%  { opacity: 1; }
      50%  { transform: translate3d(-220px, 160px, 0) rotate(26deg); opacity: 1; }
      100% { transform: translate3d(-480px, 320px, 0) rotate(22deg); opacity: 0; }
    }

    @keyframes meteorCurve3 {
      0%   { transform: translate3d(0, 0, 0) rotate(18deg);  opacity: 0; }
      8%   { opacity: 1; }
      40%  { transform: translate3d(-200px, 90px, 0) rotate(24deg); opacity: 1; }
      100% { transform: translate3d(-450px, 250px, 0) rotate(30deg); opacity: 0; }
    }

    .meteor-curve-1 { animation-name: meteorCurve1; }
    .meteor-curve-2 { animation-name: meteorCurve2; }
    .meteor-curve-3 { animation-name: meteorCurve3; }

    /* é‡‘è‰²æ¼£æ¼ªï¼ˆæ»‘åˆ°å¡ç‰‡ï¼‰ */
    .ripple-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(
        circle at var(--ripple-x) var(--ripple-y),
        rgba(247, 217, 138, 0.7) 0%,
        rgba(247, 217, 138, 0.45) 13%,
        rgba(247, 217, 138, 0.18) 34%,
        transparent 72%
      );
      opacity: 0;
      transform: scale(0.7);
      z-index: 2;
    }

    .ripple-overlay.active {
      animation: ripple 0.9s ease-out forwards;
    }

    @keyframes ripple {
      0% {
        opacity: 0.6;
        transform: scale(0.7);
      }
      100% {
        opacity: 0;
        transform: scale(2.4);
      }
    }

    .app {
      position: relative;
      z-index: 3;
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 32px;
    }

    .screen { display: none; }
    .screen.active { display: block; }

    .center-layout {
      min-height: calc(100vh - 80px);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .panel {
      width: 100%;
      max-width: 520px;
      padding: 26px 22px 20px;
      border-radius: var(--radius-lg);
      background: var(--bg-panel);
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
    }

    .title-lg {
      text-align: left;
      font-size: 22px;
      letter-spacing: 3px;
      font-weight: 700;
      margin-bottom: 4px;
      color: var(--gold);
    }

    .subtitle {
      text-align: left;
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--text-gray);
      margin-bottom: 22px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-size: 13px;
      color: var(--text-sub);
    }

    .input {
      width: 100%;
      padding: 10px 13px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #f9fafc;
      color: var(--text-main);
      font-size: 14px;
      margin-bottom: 12px;
      outline: none;
      transition: var(--transition-fast);
    }

    .input::placeholder { color: var(--text-gray); }

    .input:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 1px rgba(217, 166, 67, 0.6);
      background: #ffffff;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 10px 18px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: var(--transition-fast);
      white-space: nowrap;
    }

    .btn-primary {
      width: 100%;
      background: linear-gradient(120deg, #ffe9b6, #f0c56a);
      color: #5b3a04;
      box-shadow: 0 10px 20px rgba(209, 167, 72, 0.4);
      margin-top: 4px;
    }
    .btn-primary:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
      box-shadow: 0 13px 28px rgba(209, 167, 72, 0.55);
    }

    .btn-outline {
      width: 100%;
      margin-top: 8px;
      background: #ffffff;
      border: 1px solid var(--border-soft);
      color: var(--text-sub);
    }
    .btn-outline:hover { background: #f5f6fa; }

    .btn-danger {
      background: #ff6f7f;
      color: #ffffff;
      box-shadow: 0 8px 18px rgba(255, 111, 127, 0.4);
    }
    .btn-danger:hover { filter: brightness(1.03); }

    .error-box {
      margin-top: 10px;
      padding: 8px 11px;
      border-radius: var(--radius-md);
      background: #ffe8ea;
      border: 1px solid #ffadb5;
      color: #bc2033;
      font-size: 12px;
      text-align: center;
    }

    /* æˆæ¬Šç¢¼å¾Œå° */
    .admin-panel {
      margin-top: 16px;
      padding-top: 10px;
      border-top: 1px dashed var(--border-soft);
      display: none;
    }
    .admin-panel.active { display: block; }

    .admin-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-sub);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .admin-input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .admin-input-row .input {
      margin-bottom: 0;
      flex: 1 1 150px;
    }

    .btn-sm {
      padding: 7px 12px;
      font-size: 11px;
    }

    .code-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-sub);
    }
    .code-table th,
    .code-table td {
      padding: 5px 4px;
      border-bottom: 1px solid #edf0f5;
      text-align: left;
    }

    .badge-empty {
      font-size: 11px;
      color: var(--text-gray);
      margin-top: 4px;
    }

    /* é¸æ“‡éŠæˆ²é  */
    .game-panel {
      max-width: 720px;
      padding: 20px 18px 18px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-soft);
      background: var(--bg-panel);
      box-shadow: var(--shadow-soft);
      margin: 0 auto;
    }

    .title-md {
      text-align: left;
      font-size: 20px;
      letter-spacing: 2px;
      margin-bottom: 12px;
      color: var(--gold);
    }

    .game-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .game-card {
      flex: 1 1 48%;
      border-radius: 18px;
      border: 1px solid var(--border-soft);
      background: linear-gradient(135deg, #ffffff, #f8fafc);
      padding: 14px 13px;
      cursor: pointer;
      transition: var(--transition-fast);
      box-shadow: 0 6px 12px rgba(26, 26, 66, 0.06);
    }

    .game-card:hover {
      box-shadow: 0 9px 18px rgba(26, 26, 66, 0.12);
      transform: translateY(-1px);
    }

    .game-card.active {
      border-color: var(--gold);
      box-shadow:
        0 0 0 1px rgba(217, 166, 67, 0.8),
        0 10px 22px rgba(217, 166, 67, 0.35);
    }

    .game-name {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-main);
    }

    .note-box {
      margin-top: 14px;
      padding: 9px 11px;
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      background: var(--bg-soft);
      font-size: 12px;
      color: var(--text-sub);
    }

    .confirm-game-btn {
      margin-top: 16px;
    }

    /* æ©Ÿå°åˆ—è¡¨é  */
    .page-header {
      margin-bottom: 14px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
    }

    .title-page {
      font-size: 20px;
      letter-spacing: 3px;
      font-weight: 700;
      color: var(--gold);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: flex-end;
      gap: 6px;
    }

    .chip {
      padding: 4px 10px;
      border-radius: 999px;
      background: #ffffff;
      border: 1px solid var(--border-soft);
      font-size: 11px;
      color: var(--text-sub);
      box-shadow: 0 4px 8px rgba(26, 26, 66, 0.06);
    }

    .top-actions {
      margin: 10px auto 16px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
    }

    .select-wrap { position: relative; min-width: 160px; }

    .select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      width: 100%;
      padding: 8px 30px 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #ffffff;
      color: var(--text-main);
      font-size: 13px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(26, 26, 66, 0.06);
    }
    .select option {
      background-color: #ffffff;
      color: var(--text-main);
    }

    .select-arrow {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      font-size: 10px;
      color: var(--text-gray);
    }

    .machine-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
      gap: 10px;
    }

    .machine-card {
      position: relative;
      border-radius: 16px;
      padding: 10px 12px;
      background: #ffffff;
      border: 1px solid var(--border-soft);
      color: var(--text-main);
      box-shadow: 0 7px 16px rgba(26, 26, 66, 0.08);
      transition: var(--transition-fast);
      cursor: pointer;
    }

    .machine-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(26, 26, 66, 0.12);
    }

    .machine-card.selected {
      outline: 2px solid rgba(217, 166, 67, 0.7);
      outline-offset: 2px;
    }

    .machine-id {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 3px;
    }
    .machine-rate {
      font-size: 12px;
      color: var(--text-sub);
    }

    /* JP / è¦ºé†’é¡å¤–è¡Œ */
    .machine-rate-extra {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 1px;
    }

    .machine-card.high-rate {
      border-color: var(--gold);
      box-shadow:
        0 0 0 1px rgba(217, 166, 67, 0.8),
        0 12px 24px rgba(217, 166, 67, 0.35);
    }

    .top-badge {
      position: absolute;
      top: -8px;
      right: 10px;
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 10px;
      letter-spacing: 1px;
      background: linear-gradient(135deg, #ffeec5, #f5c86f);
      color: #5c3b0a;
      box-shadow: 0 4px 10px rgba(214, 164, 73, 0.6);
    }
    .top-badge.top-2 {
      background: linear-gradient(135deg, #f3f7ff, #cfd8f0);
      color: #364063;
    }
    .top-badge.top-3 {
      background: linear-gradient(135deg, #ffecd6, #f3b984);
      color: #5a3212;
    }

    /* Modalï¼šè³¼è²·è¨Šè™Ÿ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.95), rgba(215, 222, 238, 0.96));
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 25;
    }
    .modal-overlay.active { display: flex; }

    .signal-modal {
      width: min(640px, 92vw);
      border-radius: 22px;
      background: #ffffff;
      border: 1px solid var(--border-soft);
      box-shadow:
        0 16px 40px rgba(26, 26, 66, 0.25),
        0 0 0 1px rgba(255, 255, 255, 0.6);
      padding: 18px 18px 16px;
      position: relative;
      animation: modalIn 0.22s ease-out;
      color: var(--text-main);
    }

    @keyframes modalIn {
      0%   { opacity: 0; transform: translateY(8px) scale(0.97); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }

    .signal-header {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 12px;
      position: relative;
    }

    .signal-title {
      font-size: 20px;
      letter-spacing: 3px;
      font-weight: 700;
      color: var(--gold);
      text-align: center;
    }

    .signal-close {
      position: absolute;
      right: 0;
      top: 0;
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #f5f6fa;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      cursor: pointer;
      color: var(--text-gray);
    }

    .signal-list {
      margin: 4px 0 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .signal-item {
      display: flex;
      align-items: center;
      padding: 9px 11px;
      border-radius: 16px;
      background: linear-gradient(135deg, #ffffff, #f7f8fd);
      border: 1px solid var(--border-soft);
      box-shadow: 0 6px 14px rgba(26, 26, 66, 0.08);
      opacity: 0;
      transform: translateY(5px);
      animation: itemIn 0.3s ease-out forwards;
      animation-delay: var(--delay, 0ms);
    }

    @keyframes itemIn {
      0%   { opacity: 0; transform: translateY(5px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .signal-icon-wrapper {
      width: 44px;
      height: 44px;
      border-radius: 16px;
      background: #ffffff;
      border: 1px solid var(--border-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      flex-shrink: 0;
      box-shadow: 0 6px 12px rgba(26, 26, 66, 0.12);
    }

    /* åœ–ç‰‡ç‰ˆ icon */
    .signal-icon-img {
      width: 32px;
      height: 32px;
      object-fit: contain;
      display: block;
    }

    .signal-text {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .signal-name {
      font-size: 14px;
      font-weight: 600;
    }
    .signal-sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    .signal-qty {
      border-radius: 999px;
      padding: 6px 12px;
      background: linear-gradient(135deg, #fff0c5, #f2c873);
      color: #5b3907;
      font-size: 13px;
      font-weight: 700;
      box-shadow: 0 6px 14px rgba(217, 166, 67, 0.4);
    }

    .signal-footer { margin-top: 2px; }

    .signal-tip {
      padding: 8px 11px;
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      background: #f9fafc;
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 10px;
    }
    .signal-tip b { color: var(--gold); }

    .signal-confirm {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 10px 16px;
      font-size: 13px;
      font-weight: 600;
      background: linear-gradient(120deg, #ffe9b6, #f0c56a);
      color: #5b3a04;
      cursor: pointer;
      box-shadow: 0 10px 22px rgba(209, 167, 72, 0.4);
      transition: var(--transition-fast);
    }
    .signal-confirm:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    /* Loading */
    .loading-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at center, rgba(255, 255, 255, 0.96), rgba(228, 233, 245, 0.96));
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }
    .loading-overlay.active { display: flex; }

    .loader {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .spinner {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 3px solid rgba(198, 204, 221, 0.4);
      border-top-color: var(--gold);
      animation: spin 0.8s linear infinite;
    }
    .loader-text {
      font-size: 12px;
      color: var(--text-sub);
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    @media (max-width: 768px) {
      .app { padding: 18px 12px 28px; }
      .panel, .game-panel { padding: 20px 16px 14px; }
      .title-lg { font-size: 20px; }
      .page-header { flex-direction: column; align-items: flex-start; }
      .chip-row { justify-content: flex-start; }
      .machine-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }
    }
  </style>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <!-- èƒŒæ™¯å±¤ -->
  <div class="bg-rays"></div>
  <div class="bg-stars"></div>
  <div class="bg-glow"></div>
  <div class="bg-meteors" id="bgMeteors"></div>
  <div class="ripple-overlay" id="rippleOverlay"></div>

  <!-- Loading -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loader">
      <div class="spinner"></div>
      <div class="loader-text">ç³»çµ±åˆ†æä¸­ï¼Œè«‹ç¨å€™â€¦</div>
    </div>
  </div>

  <!-- è³¼è²·è¨Šè™Ÿ Modal -->
  <div class="modal-overlay" id="signalModal">
    <div class="signal-modal">
      <div class="signal-header">
        <div class="signal-title" id="signalTitle">ç¬¬ 0000 æˆ¿è³¼è²·è¨Šè™Ÿ</div>
        <button class="signal-close" id="signalClose">âœ•</button>
      </div>
      <div class="signal-list" id="signalItemList"></div>
      <div class="signal-footer">
        <div class="signal-tip">
          <b>ç³»çµ±æç¤ºï¼š</b>
          æ­¤è³¼è²·è¨Šè™Ÿç‚º AI æ™ºèƒ½ç”Ÿæˆï¼Œå»ºè­°åƒè€ƒçˆ†åˆ†ç‡
          <b id="signalRateText">75%</b> é€²è¡Œåˆ†æã€‚
        </div>
        <button class="signal-confirm" id="signalConfirm">ç¢ºèª</button>
      </div>
    </div>
  </div>

  <div class="app">
    <!-- Screen 1ï¼šç™»å…¥ -->
    <div class="screen active" id="screenLogin">
      <div class="center-layout">
        <div class="panel">
          <div class="title-lg">PROGRAM PRO 3.0</div>
          <div class="subtitle">AUTHENTICATION Â· ACCESS CONTROL</div>

          <label>ç³»çµ±æˆæ¬Šç¢¼</label>
          <input id="licenseInput" class="input" placeholder="è«‹è¼¸å…¥æˆæ¬Šç¢¼" />

          <label>å¹³å°å¸³è™Ÿ</label>
          <input id="accountInput" class="input" placeholder="è«‹è¼¸å…¥éŠæˆ²å¸³è™Ÿ" />

          <label>é€²å ´é‡‘é¡</label>
          <input id="amountInput" class="input" type="number" min="0" placeholder="è«‹è¼¸å…¥é€²å ´é‡‘é¡" />

          <button class="btn btn-primary" id="btnVerify">é©—è­‰ä¸¦é€²å…¥ç³»çµ±</button>
          <button class="btn btn-outline" id="btnToggleAdmin">ç®¡ç†æˆæ¬Šç¢¼</button>

          <div class="error-box" id="loginError" style="display:none;">
            æˆæ¬Šç¢¼ç„¡æ•ˆï¼šåºè™Ÿä¸å­˜åœ¨æˆ–å·²éæœŸ
          </div>

          <!-- æˆæ¬Šç¢¼ç®¡ç†å¾Œå° -->
          <div class="admin-panel" id="adminPanel">
            <div class="admin-title">
              æˆæ¬Šç¢¼ç®¡ç†å¾Œå°
              <span style="font-size:11px;color:var(--text-gray);">ï¼ˆï¼‰</span>
            </div>
            <div class="admin-input-row">
              <input id="adminCodeInput" class="input" placeholder="æˆæ¬Šç¢¼ï¼Œä¾‹å¦‚ GC-2025-001" />
              <input id="adminExpireInput" class="input" type="date" />
              <button class="btn btn-primary btn-sm" id="btnAddCode">æ–°å¢</button>
            </div>
            <table class="code-table">
              <thead>
              <tr><th>æˆæ¬Šç¢¼</th><th>åˆ°æœŸæ—¥</th><th>æ“ä½œ</th></tr>
              </thead>
              <tbody id="codeTableBody"></tbody>
            </table>
            <div class="badge-empty" id="emptyCodesHint">å°šæœªå»ºç«‹ä»»ä½•æˆæ¬Šç¢¼ã€‚</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Screen 2ï¼šé¸æ“‡éŠæˆ² -->
    <div class="screen" id="screenGame">
      <div class="center-layout">
        <div class="game-panel">
          <div class="title-md">é¸æ“‡éŠæˆ²æ¨¡çµ„</div>
          <div class="game-list">
            <div class="game-card" data-id="ATG1">
              <div class="game-name">ATG-æˆ°ç¥è³½ç‰¹</div>
            </div>
            <div class="game-card" data-id="ATG2">
              <div class="game-name">ATG-æˆ°ç¥è³½ç‰¹2è¦ºé†’ä¹‹åŠ›</div>
            </div>
          </div>

          <div class="note-box">
            é¸å®šéŠæˆ²å¾Œæœƒè‡ªå‹•ç²å–éŠæˆ²æ•¸æ“šä¸¦æä¾›åˆ†æï¼Œéš¨æ™‚å¯ç”¨ã€Œåˆ‡æ›éŠæˆ²ã€é‡æ–°é¸æ“‡éŠæˆ²ã€‚
          </div>

          <button class="btn btn-primary confirm-game-btn" id="btnGameConfirm" disabled>é–‹å§‹åˆ†æ</button>
        </div>
      </div>
    </div>

    <!-- Screen 3ï¼šæ©Ÿå°åˆ—è¡¨ -->
    <div class="screen" id="screenDashboard">
      <div class="page-header">
        <div class="title-page" id="titlePage">GRå°ˆç”¨æˆ°ç¥è³½ç‰¹</div>
        <div class="chip-row">
          <div class="chip" id="chipAccount">å¸³è™Ÿï¼š-</div>
          <div class="chip" id="chipAmount">é‡‘é¡ï¼š-</div>
          <div class="chip" id="chipGame">ç•¶å‰éŠæˆ²ï¼š-</div>
        </div>
      </div>

      <div class="top-actions">
        <button class="btn btn-primary" id="btnRefresh">é»æ­¤æ›´æ–°æ•¸æ“š</button>
        <div class="select-wrap">
          <select class="select" id="gameSelect">
            <option value="">åˆ‡æ›éŠæˆ²</option>
            <option value="ATG1">ATG-æˆ°ç¥è³½ç‰¹</option>
            <option value="ATG2">ATG-æˆ°ç¥è³½ç‰¹2è¦ºé†’ä¹‹åŠ›</option>
          </select>
          <span class="select-arrow">â–¼</span>
        </div>
        <button class="btn btn-danger" id="btnLogout">ç™»å‡ºç³»çµ±</button>
      </div>

      <div class="machine-grid" id="machineGrid"></div>
    </div>
  </div>
<script>
    // ç°¡æ˜“ç‰ˆ showLoading
    function showLoading(ms = 500) {
      return new Promise((resolve) => {
        setTimeout(resolve, ms);
      });
    }

    // åˆ‡æ›ç•«é¢
    function showScreen(name) {
      const loginScreen = document.getElementById("screenLogin");
      const gameScreen = document.getElementById("screenGame");
      const dashboardScreen = document.getElementById("screenDashboard");

      if (!loginScreen || !gameScreen || !dashboardScreen) return;

      loginScreen.classList.remove("active");
      gameScreen.classList.remove("active");
      dashboardScreen.classList.remove("active");

      if (name === "login") loginScreen.classList.add("active");
      else if (name === "game") gameScreen.classList.add("active");
      else if (name === "dashboard") dashboardScreen.classList.add("active");
    }

    // Firebase è¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyDNs7BP2h51PzsJZ9Lro0Ev1nzyqZM-1Qs",
      authDomain: "gg-pro-3.firebaseapp.com",
      projectId: "gg-pro-3",
      storageBucket: "gg-pro-3.firebasestorage.app",
      messagingSenderId: "460046000234",
      appId: "1:460046000234:web:e1c72ba1758376ce582a13",
      measurementId: "G-5Z31YLQERV"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const ADMIN_PASSWORD = "aa888";
    const MACHINE_COUNT = 60;

    // æˆ¿è™Ÿä¸Šé™æ”¹ç‚º 3000
    const GAME_CONFIG = {
      ATG1: { name: "ATG-æˆ°ç¥è³½ç‰¹", title: "GRå°ˆç”¨æˆ°ç¥è³½ç‰¹", maxMachine: 3000 },
      ATG2: { name: "ATG-æˆ°ç¥è³½ç‰¹2è¦ºé†’ä¹‹åŠ›", title: "GRå°ˆç”¨æˆ°ç¥è³½ç‰¹2", maxMachine: 3000 }
    };

    // é“å…·è³‡æ–™
    const SIGNAL_ITEMS = [
      { id: "eye", name: "çœ¼", sub: "é«˜æ©Ÿç‡ç‰¹æ®Šåœ–ç¤º" },
      { id: "snake", name: "è›‡", sub: "å¤šç·šé€£å‹•æ™‚è¡¨ç¾ä½³" },
      { id: "knife", name: "å½åˆ€", sub: "é«˜å€ç·šå‹è½‰æŠ˜é—œéµ" },
      { id: "bow", name: "å¼“ç®­", sub: "æ­é…çœ¼åœ–æ™‚çˆ†åˆ†åŠ æˆ" },
      { id: "blue", name: "è—å¯¶çŸ³", sub: "ç©©å®šç·šå‹è£œåœ–" },
      { id: "green", name: "ç¶ å¯¶çŸ³", sub: "é€£ç·šå»¶ä¼¸æ©Ÿç‡æå‡" },
      { id: "purple", name: "ç´«å¯¶çŸ³", sub: "é«˜åƒ¹å€¼å¯¶çŸ³çµ„åˆ" },
      { id: "red", name: "ç´…å¯¶çŸ³", sub: "ä¸­æ®µçˆ†æ“Šè§¸ç™¼é»" },
      { id: "yellow", name: "é»ƒå¯¶çŸ³", sub: "ä¸­é«˜å€è£œåœ–" },
      { id: "scatter", name: "SCATTER", sub: "é«˜çˆ†åˆ†é—œéµè§¸ç™¼ç¬¦è™Ÿ" }
    ];

    // æ•¸é‡ä¸Šé™è¦å‰‡
    function getMaxQtyForItem(id) {
      if (["eye", "snake", "knife", "bow"].includes(id)) return 5;
      if (id === "scatter") return 3;
      return 7;
    }

    const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

    // è³¼è²·è¨Šè™Ÿ Modal
    function openSignalModal(machineNo, rate) {
      document.getElementById("signalTitle").textContent = `ç¬¬ ${machineNo} æˆ¿è³¼è²·è¨Šè™Ÿ`;
      const shuffled = [...SIGNAL_ITEMS].sort(() => Math.random() - 0.5);
      const picked = shuffled.slice(0, 3);
      const list = document.getElementById("signalItemList");
      list.innerHTML = "";

      picked.forEach((item, idx) => {
        if (!item || !item.id) return;
        const maxQty = getMaxQtyForItem(item.id);
        const qty = rand(1, maxQty);

        const row = document.createElement("div");
        row.className = "signal-item";
        row.style.setProperty("--delay", `${idx * 70}ms`);

        const iconWrap = document.createElement("div");
        iconWrap.className = "signal-icon-wrapper";
        const img = document.createElement("img");
        img.className = "signal-icon-img";
        // åœ–ç‰‡è·¯å¾‘ï¼Œè‹¥ç„¡å°æ‡‰å‰‡ç”¨ scatter
        img.src = `images/${item.id}.png`; 
        img.onerror = function() { this.src = 'images/scatter.png'; }; // å®¹éŒ¯
        img.alt = item.name;
        iconWrap.appendChild(img);

        const textWrap = document.createElement("div");
        textWrap.className = "signal-text";
        textWrap.innerHTML = `<div class="signal-name">${item.name}</div><div class="signal-sub">${item.sub}</div>`;

        const qtyPill = document.createElement("div");
        qtyPill.className = "signal-qty";
        qtyPill.textContent = `Ã— ${qty}`;

        row.append(iconWrap, textWrap, qtyPill);
        list.appendChild(row);
      });

      document.getElementById("signalRateText").textContent = rate + "%";
      document.getElementById("signalModal").classList.add("active");
    }

    const closeSignalModal = () => document.getElementById("signalModal").classList.remove("active");
    document.getElementById("signalClose").onclick = closeSignalModal;
    document.getElementById("signalConfirm").onclick = closeSignalModal;
    document.getElementById("signalModal").addEventListener("click", e => {
      if (e.target === document.getElementById("signalModal")) closeSignalModal();
    });

    // Ripple ç‰¹æ•ˆ
    function triggerRipple(event) {
      const x = event.clientX;
      const y = event.clientY;
      document.documentElement.style.setProperty("--ripple-x", x + "px");
      document.documentElement.style.setProperty("--ripple-y", y + "px");
      const r = document.getElementById("rippleOverlay");
      r.classList.remove("active");
      void r.offsetWidth;
      r.classList.add("active");
    }

    // â­ æ ¸å¿ƒå‡½å¼ï¼šå–å¾—ä»Šå¤©çš„ã€Œåˆå¤œæ™‚é–“ã€ç‰©ä»¶ï¼Œç”¨æ–¼ç²¾æº–æ¯”å°
    function getTodayDate() {
        const now = new Date();
        now.setHours(0, 0, 0, 0); // æ­¸é›¶æ™‚åˆ†ç§’ï¼Œåªæ¯”å°æ—¥æœŸ
        return now;
    }

    // â­ ç™»å…¥æ™‚æª¢æŸ¥ï¼šé©—è­‰æˆæ¬Šç¢¼ä¸¦è‡ªå‹•åˆªé™¤éæœŸ (ä¿®æ­£ç‰ˆ)
    async function isLicenseValid(code) {
      try {
        const snapshot = await db.collection("licenses").where("code", "==", code).get();
        if (snapshot.empty) return false;

        let valid = false;
        const today = getTodayDate();

        // ä½¿ç”¨ for...of ç¢ºä¿ await delete åŸ·è¡Œ
        for (const doc of snapshot.docs) {
          const data = doc.data() || {};
          let expireStr = (data.expire || "").trim();
          
          if (expireStr) {
              // çµ±ä¸€å°‡ / æ›æˆ - ç¢ºä¿æ ¼å¼å¯è¢«è§£æ
              expireStr = expireStr.replace(/\//g, '-');
              const expDate = new Date(expireStr);
              
              // â­ æ—¥æœŸç‰©ä»¶æ¯”å°ï¼šå¦‚æœ åˆ°æœŸæ—¥ < ä»Šå¤©
              if (expDate < today) {
                await db.collection("licenses").doc(doc.id).delete();
                console.log("ç™»å…¥åµæ¸¬ï¼šåºè™Ÿå·²éæœŸï¼Œè‡ªå‹•åˆªé™¤", code);
                continue; // åˆªé™¤äº†å°±è·³éï¼Œä¸è¨­ç‚º valid
              }
          }
          // æ²’éæœŸ (æˆ–æ˜¯æ²’è¨­æœŸé™)ï¼Œè¦–ç‚ºæœ‰æ•ˆ
          valid = true;
        }
        return valid;
      } catch (err) {
        console.error("é©—è­‰å¤±æ•—", err);
        return false;
      }
    }

    // ç™»å…¥æŒ‰éˆ•äº‹ä»¶
    document.getElementById("btnVerify").addEventListener("click", async () => {
      const code = document.getElementById("licenseInput").value.trim();
      const errorBox = document.getElementById("loginError");
      
      if (!code) {
        errorBox.textContent = "è«‹è¼¸å…¥æˆæ¬Šç¢¼";
        errorBox.style.display = "block";
        return;
      }
      
      const isValid = await isLicenseValid(code);
      if (!isValid) {
        errorBox.textContent = "æˆæ¬Šç¢¼ç„¡æ•ˆï¼šä¸å­˜åœ¨æˆ–å·²éæœŸ";
        errorBox.style.display = "block";
        return;
      }

      localStorage.setItem("ofa_account", document.getElementById("accountInput").value.trim() || "æœªè¨­å®š");
      localStorage.setItem("ofa_amount", document.getElementById("amountInput").value.trim() || "-");
      errorBox.style.display = "none";
      await showLoading();
      showScreen("game");
    });

    // â­ å¾Œå°ç®¡ç†ï¼šè‡ªå‹•åˆªé™¤éæœŸ + é¡¯ç¤ºåˆ—è¡¨ (ä¿®æ­£ç‰ˆ)
    const adminPanel = document.getElementById("adminPanel");
    const codeTableBody = document.getElementById("codeTableBody");
    const emptyCodesHint = document.getElementById("emptyCodesHint");
    let adminUnlocked = false;

    document.getElementById("btnToggleAdmin").addEventListener("click", () => {
      if (!adminUnlocked) {
        const pwd = prompt("è«‹è¼¸å…¥ç®¡ç†è€…å¯†ç¢¼ï¼š");
        if (pwd !== ADMIN_PASSWORD) { alert("å¯†ç¢¼éŒ¯èª¤"); return; }
        adminUnlocked = true;
      }
      adminPanel.classList.toggle("active");
      if (adminPanel.classList.contains("active")) {
        renderCodeTable();
      }
    });

    async function renderCodeTable() {
      codeTableBody.innerHTML = "";
      if (emptyCodesHint) emptyCodesHint.style.display = "none";
      
      const today = getTodayDate(); // å–å¾—ä»Šå¤©æ¨™æº–æ™‚é–“

      try {
        // 1. å…ˆæŠ“å–ä¸¦åˆªé™¤éæœŸ
        const allDocs = await db.collection("licenses").get();
        for (const doc of allDocs.docs) {
          const data = doc.data();
          let expireStr = (data.expire || "").trim();

          if (expireStr) {
             expireStr = expireStr.replace(/\//g, '-');
             const expDate = new Date(expireStr);
             
             // â­ æ—¥æœŸç‰©ä»¶æ¯”å°
             if (expDate < today) {
                await db.collection("licenses").doc(doc.id).delete();
                console.log("å¾Œå°æƒæï¼šåˆªé™¤éæœŸåºè™Ÿ", data.code);
             }
          }
        }

        // 2. é‡æ–°è®€å–æœ‰æ•ˆè³‡æ–™
        const snapshot = await db.collection("licenses").orderBy("code").get();
        if (snapshot.empty) {
          if (emptyCodesHint) {
            emptyCodesHint.textContent = "å°šæœªå»ºç«‹ä»»ä½•æˆæ¬Šç¢¼ã€‚";
            emptyCodesHint.style.display = "block";
          }
          return;
        }

        // 3. æ¸²æŸ“è¡¨æ ¼
        snapshot.forEach(doc => {
          const data = doc.data() || {};
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${data.code}</td>
            <td>${data.expire || "-"}</td>
            <td><button class="btn btn-danger btn-sm" onclick="manualDelete('${doc.id}', '${data.code}')">åˆªé™¤</button></td>
          `;
          codeTableBody.appendChild(tr);
        });
      } catch (err) {
        console.error("åˆ—è¡¨è®€å–å¤±æ•—", err);
      }
    }

    window.manualDelete = async (id, code) => {
      if (!confirm(`ç¢ºå®šåˆªé™¤ã€Œ${code}ã€ï¼Ÿ`)) return;
      await db.collection("licenses").doc(id).delete();
      renderCodeTable();
    };

    document.getElementById("btnAddCode").addEventListener("click", async () => {
      const code = document.getElementById("adminCodeInput").value.trim();
      const expire = document.getElementById("adminExpireInput").value.trim();
      if (!code) { alert("è«‹è¼¸å…¥æˆæ¬Šç¢¼"); return; }

      // æª¢æŸ¥é‡è¤‡
      const dup = await db.collection("licenses").where("code", "==", code).get();
      if (!dup.empty) { alert("æ­¤æˆæ¬Šç¢¼å·²å­˜åœ¨"); return; }

      await db.collection("licenses").add({ code, expire });
      document.getElementById("adminCodeInput").value = "";
      alert("æ–°å¢æˆåŠŸ");
      renderCodeTable();
    });

    // éŠæˆ²é¸æ“‡èˆ‡æ©Ÿå°ç”Ÿæˆ
    let selectedGameId = null;
    const gameCards = document.querySelectorAll(".game-card");
    const btnGameConfirm = document.getElementById("btnGameConfirm");

    gameCards.forEach(card => {
      card.addEventListener("click", () => {
        gameCards.forEach(c => c.classList.remove("active"));
        card.classList.add("active");
        selectedGameId = card.dataset.id;
        btnGameConfirm.disabled = false;
      });
    });

    btnGameConfirm.addEventListener("click", async () => {
      if (!selectedGameId) return;
      localStorage.setItem("ofa_selected_game", selectedGameId);
      await showLoading();
      initDashboard();
      showScreen("dashboard");
    });

    function getCurrentGameConfig() {
      const id = selectedGameId || localStorage.getItem("ofa_selected_game") || "ATG1";
      selectedGameId = id;
      return GAME_CONFIG[id] || GAME_CONFIG.ATG1;
    }

    function generateMachines() {
      const cfg = getCurrentGameConfig();
      const used = new Set();
      const list = [];
      const machineGrid = document.getElementById("machineGrid");

      // éš¨æ©Ÿç”Ÿæˆ 60 å°ï¼Œæˆ¿è™Ÿä¸Šé™ 3000
      while (list.length < MACHINE_COUNT) {
        const num = rand(1, 3000); 
        if (used.has(num)) continue;
        used.add(num);

        const rate = rand(60, 89);
        const jpRate = rand(60, 90);
        const awakenRate = (cfg === GAME_CONFIG.ATG2) ? rand(30, 90) : null;
        list.push({ no: num, rate, jpRate, awakenRate });
      }

      const sorted = [...list].sort((a, b) => b.rate - a.rate);
      const t1 = sorted[0], t2 = sorted[1], t3 = sorted[2];

      machineGrid.innerHTML = "";
      list.forEach(m => {
        const card = document.createElement("div");
        card.className = "machine-card";
        if (m.rate >= 80) card.classList.add("high-rate");

        if (t1 && m.no === t1.no) card.innerHTML += `<div class="top-badge">TOP 1</div>`;
        else if (t2 && m.no === t2.no) card.innerHTML += `<div class="top-badge top-2">TOP 2</div>`;
        else if (t3 && m.no === t3.no) card.innerHTML += `<div class="top-badge top-3">TOP 3</div>`;

        const idEl = `<div class="machine-id">ç¬¬ ${m.no} å°</div>`;
        const rateEl = `<div class="machine-rate">å¤§ççˆ†åˆ†ç‡ ${m.rate}%</div>`;
        const jpEl = `<div class="machine-rate-extra">JPå½©æ± å‘½ä¸­ç‡ ${m.jpRate}%</div>`;
        let awakenEl = "";
        if (m.awakenRate) awakenEl = `<div class="machine-rate-extra">è¦ºé†’æ©Ÿç‡ ${m.awakenRate}%</div>`;

        card.innerHTML += idEl + rateEl + jpEl + awakenEl;

        card.addEventListener("mouseenter", triggerRipple);
        card.addEventListener("click", () => {
          document.querySelectorAll(".machine-card.selected").forEach(c => c.classList.remove("selected"));
          card.classList.add("selected");
          openSignalModal(m.no, m.rate);
        });
        machineGrid.appendChild(card);
      });
    }

    function initDashboard() {
      const cfg = getCurrentGameConfig();
      const account = localStorage.getItem("ofa_account") || "æœªè¨­å®š";
      const amount = localStorage.getItem("ofa_amount") || "-";

      document.getElementById("titlePage").textContent = cfg.title;
      document.getElementById("chipAccount").textContent = "å¸³è™Ÿï¼š" + account;
      document.getElementById("chipAmount").textContent = "é‡‘é¡ï¼š" + amount;
      document.getElementById("chipGame").textContent = "ç•¶å‰éŠæˆ²ï¼š" + cfg.name;

      generateMachines();
    }

    document.getElementById("btnRefresh").onclick = () => generateMachines();
    document.getElementById("btnLogout").onclick = () => { showScreen("login"); };

    document.getElementById("gameSelect").addEventListener("change", async e => {
      const val = e.target.value;
      if (!val) return;
      selectedGameId = val;
      localStorage.setItem("ofa_selected_game", val);
      await showLoading(400);
      initDashboard();
      showScreen("dashboard");
      e.target.value = "";
    });

    // æµæ˜ŸèƒŒæ™¯
    function initMeteorTrails() {
      const container = document.getElementById("bgMeteors");
      if (!container) return;
      for (let i = 0; i < 10; i++) {
        const el = document.createElement("div");
        el.className = `meteor-trail meteor-curve-${rand(1, 3)}`;
        el.style.left = rand(-10, 110) + "%";
        el.style.top = rand(-20, 40) + "%";
        el.style.animationDuration = rand(2, 7) + "s";
        el.style.animationDelay = rand(0, 12) + "s";
        container.appendChild(el);
      }
    }
    document.addEventListener("DOMContentLoaded", () => {
      initMeteorTrails();
    });
  </script>
</body>
</html>
